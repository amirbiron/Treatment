# בקשות משתמש – תרופות, תזמונים, מטפלים ודוחות

המסמך מרכז את כל הבקשות שהועלו, כדי לשמש כ־Checklist לאחר שחזור קוד.

## תזמון מודע־אזור זמן (תיקון איחור 3 שעות)
- להשתמש באזור הזמן של המשתמש; ברירת מחדל: Asia/Jerusalem.
- תזמון תרופות, Snooze, ותורים יעבדו עם CronTrigger/DateTrigger מודעי־TZ.
- לכבד DST; לא לשנות חתימות ציבוריות; לוגיקת דיפלוי/וובהוק ללא שינוי.
- עזרי זמן ב־`utils/time.py` (DEFAULT_TZ_NAME, get_timezone, get_user_timezone_name, ensure_aware, now_in_timezone).

## מחיקת תרופה
- כפתור אישור מחיקה:
  - ביטול כל ה־jobs הקשורים (כולל Snooze) בסקד׳ולר.
  - מחיקה מה־DB.
  - הודעת הצלחה קצרה: "✅ התרופה נמחקה" ואז תפריט ראשי.
  - לטפל במצבי קצה: תרופה לא קיימת, שגיאות DB, ביטול פעולה.

## UI תרופה – פרטי תרופה
- שינוי אימוג׳י מינון ל־🧪.
- הסרת שורות "נוצר:" ו"פעיל:".

## תפריט ראשי
- "התרופות שלי" תופס שורה מלאה.
- אין שורות עם 3 כפתורים.
- "הוספת תור" לא תופס שורה לבד; חולק שורה עם כפתורים אחרים.

## מסך "אין תרופות"
- טקסט: "לחצו על 'הוסף תרופה' כדי להוסיף תרופה ראשונה."

## מטפלים – תפריט וניהול
- להסיר את כפתור "הוסף מטפל" מהתפריט הראשי של מטפלים.
- במסך "אין מטפלים" – כפתור: "🔗 הזמן מטפל (קוד/קישור)".
- Auto-onboard: אם המשתמש לא נמצא (למשל אחרי דיפלוי), ליצור אותו אוטומטית כדי למנוע דרישה ל־/start.



## דוחות – דיוק מנות נלקחו/דולגו/הוחמצו
- לספור לפי scheduled_time או created_at בטווח התאריכים (OR), גם ברמת היום.
- עדכון קריאות ה־DB התואמות (גם ל־SQLite וגם ל־Mongo, לפי backend).

## קבצים רלוונטיים
- `utils/time.py` – עזרי זמן וברירת מחדל לאזור זמן.
- `scheduler.py` – תזמונים מודעי־TZ, ביטולי Jobs, תורים.
- `handlers/medicine_handler.py` – יצירה, מחיקה, תצוגת פרטים ועדכון UI.
- `handlers/__init__.py` – רישום Callback למחיקות.
- `handlers/appointments_handler.py` – תורים ותזמונים מודעי־TZ.
- `handlers/caregiver_handler.py` – ניהול והזמנה; auto-onboard; כפתור העתק יחיד.
- `handlers/reports_handler.py` – חישובי ציות מדויקים.
- `utils/keyboards.py` – פריסות מקלדות (תפריט ראשי, מטפלים, תרופות).
- `main.py` – ללא שינויי deploy/webhook; התאמות טקסט "אין תרופות".
- `database.py` – ללא שינוי אם Mongo קיים; אחרת, לשמר Backend כפול וליישר API.

## קריטריוני קבלה
- תזמון: משתמש Asia/Jerusalem שמגדיר 21:00 מקבל תזכורת ב־21:00 מקומי (כולל DST). אם אין TZ – להשתמש ב־Asia/Jerusalem.
- ללא גלישה ליום הבא, ללא כפל התראות.
- מחיקה: ביטול תזמונים, מחיקה, הודעת הצלחה ותפריט ראשי. ללא חריגות בלוגים.
- תפריט ראשי: "התרופות שלי" שורה מלאה; אין שורות עם 3 כפתורים.
- הזמנה למטפל: הודעה מדויקת וכפתור העתק יחיד.
- דוחות: ספירת taken/skipped/missed מדויקת לפי scheduled_time/created_at.

## בדיקות
- יחידות: פונקציות זמן כולל מעבר DST.
- ידני: הוספת תרופה עם שעה קרובה; אימות התראה בזמן המקומי; מחיקה בלחיצה; הזמנת מטפל; דוח שבועי.
